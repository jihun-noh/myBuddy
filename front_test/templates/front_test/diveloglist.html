<!doctype html>
<html>
<head>
    <title>다이빙로그</title>
</head>
<body>
    {% load static %}
    <script src="{% static 'front_test/js/jquery-3.5.1.min.js' %}" type="text/javascript"></script>
    <script src="{% static 'front_test/js/utils.js' %}" type="text/javascript"></script>
    <script>
    $(document).ready(function() {
        document.getElementById("newlog").onclick = function() {
            const pointId = getUrlParams().pointid;
            location.href=`http://127.0.0.1:8000/front/divelogform/?logid=${0}&pointid=${pointId}`;
        }
        init();
    });

    function init(){
        const pointId = getUrlParams().pointid;
        getLogList(pointId);
        return;
    }

    function getLogList(pointId){
        var diveLogs = [];
        var url = "http://127.0.0.1:8000/dive/divelogs/";
        var data = {"point_id":pointId};
        requestAjax("GET", url, data, function(response){
            response.forEach(function(log){
                diveLogs.push(log);
            });
            initTable(diveLogs);
            console.log(diveLogs);
        });
        return;
    }

    function initTable(diveLogs){
        for(var i=0; i<diveLogs.length; i++){
            var table = document.getElementById("table_log");
            var newRow = table.insertRow(-1);
            let cell1 = newRow.insertCell(0);
            let cell2 = newRow.insertCell(1);
            let text1 = document.createTextNode(diveLogs[i]["log_nm"]);
            let text2 = document.createTextNode(diveLogs[i]["dive_date"]);
            cell1.appendChild(text1);
            cell2.appendChild(text2);
        }
        $("#table_log tr").click(function(){
            var tr = $(this);
            for(var i=0; i<diveLogs.length; i++){
                if(tr.children()[0].textContent == diveLogs[i]["log_nm"]){
                    location.href=`http://127.0.0.1:8000/front/divelogform/?logid=${diveLogs[i]["id"]}&pointid=${diveLogs[i]["point_id"]}`;
                    break;
                }
            }
        });
    }
    </script>
    <div>
        <table id="table_log" border="1">
        </table>
        <input type="button" value="newlog" id="newlog"/>
    </div>
</body>
</html>
